VERSION 5.00
Object = "{BDC217C8-ED16-11CD-956C-0000C04E4C0A}#1.1#0"; "TABCTL32.OCX"
Object = "{86CF1D34-0C5F-11D2-A9FC-0000F8754DA1}#2.0#0"; "MSCOMCT2.OCX"
Object = "{5E9E78A0-531B-11CF-91F6-C2863C385E30}#1.0#0"; "msflxgrd.ocx"
Begin VB.Form frmBia_Exploitation 
   AutoRedraw      =   -1  'True
   Caption         =   "Bia_Explotation"
   ClientHeight    =   9492
   ClientLeft      =   60
   ClientTop       =   348
   ClientWidth     =   13872
   Icon            =   "Bia_Exploitation.frx":0000
   LinkTopic       =   "Form1"
   ScaleHeight     =   9492
   ScaleWidth      =   13872
   Begin VB.ListBox lstErr 
      BackColor       =   &H00E0E0E0&
      ForeColor       =   &H000000FF&
      Height          =   432
      Left            =   8280
      TabIndex        =   4
      Top             =   45
      Width           =   5055
   End
   Begin TabDlg.SSTab SSTab1 
      Height          =   8895
      Left            =   0
      TabIndex        =   3
      Top             =   480
      Width           =   13815
      _ExtentX        =   24363
      _ExtentY        =   15685
      _Version        =   393216
      Tabs            =   2
      TabsPerRow      =   2
      TabHeight       =   520
      TabCaption(0)   =   "Sélection"
      TabPicture(0)   =   "Bia_Exploitation.frx":000C
      Tab(0).ControlEnabled=   -1  'True
      Tab(0).Control(0)=   "fraSelect"
      Tab(0).Control(0).Enabled=   0   'False
      Tab(0).ControlCount=   1
      TabCaption(1)   =   "Statistiques"
      TabPicture(1)   =   "Bia_Exploitation.frx":0028
      Tab(1).ControlEnabled=   0   'False
      Tab(1).ControlCount=   0
      Begin VB.Frame fraSelect 
         Height          =   8445
         Left            =   120
         TabIndex        =   5
         Top             =   360
         Width           =   13560
         Begin VB.CommandButton cmdUpdate_Quit 
            BackColor       =   &H00C0C0FF&
            Caption         =   "Abandonner"
            Height          =   525
            Left            =   11040
            Style           =   1  'Graphical
            TabIndex        =   24
            Top             =   6720
            Width           =   1575
         End
         Begin VB.CommandButton cmdUpdate_Ok 
            BackColor       =   &H00C0FFC0&
            Caption         =   "Enregistrer"
            Height          =   1005
            Left            =   11040
            Style           =   1  'Graphical
            TabIndex        =   23
            Top             =   5280
            Width           =   1575
         End
         Begin VB.Frame fraMemogarde_Retour 
            Caption         =   "Retour du conteneur"
            BeginProperty Font 
               Name            =   "MS Sans Serif"
               Size            =   9.6
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H0000C000&
            Height          =   4335
            Left            =   120
            TabIndex        =   9
            Top             =   3840
            Width           =   9015
            Begin VB.TextBox txtMemogarde_Retour_Commentaire 
               Height          =   375
               Left            =   1560
               TabIndex        =   22
               Top             =   3720
               Width           =   5415
            End
            Begin MSFlexGridLib.MSFlexGrid fgList 
               Height          =   2985
               Left            =   120
               TabIndex        =   10
               Top             =   480
               Width           =   8760
               _ExtentX        =   15452
               _ExtentY        =   5271
               _Version        =   393216
               Rows            =   1
               Cols            =   8
               FixedCols       =   0
               RowHeightMin    =   300
               BackColor       =   16777210
               ForeColor       =   8388608
               BackColorFixed  =   16776921
               ForeColorFixed  =   -2147483641
               BackColorSel    =   12648384
               BackColorBkg    =   16777210
               WordWrap        =   -1  'True
               AllowBigSelection=   0   'False
               TextStyleFixed  =   4
               FocusRect       =   2
               HighLight       =   0
               GridLines       =   3
               GridLinesFixed  =   1
               AllowUserResizing=   3
               FormatString    =   "<Conteneur  |>Lien        |<Date Compta   |<IBM        |<Windows |<Horodatage                    ||"
               BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
                  Name            =   "Courier New"
                  Size            =   8.4
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
            End
            Begin VB.Label lblMemogarde_Retour_Commentaire 
               Caption         =   "Commentaire"
               Height          =   255
               Left            =   240
               TabIndex        =   21
               Top             =   3840
               Width           =   1215
            End
         End
         Begin VB.Frame fraMemogarde_Envoi 
            Caption         =   "Envoi du conteneur"
            BeginProperty Font 
               Name            =   "MS Sans Serif"
               Size            =   9.6
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H000000FF&
            Height          =   2775
            Left            =   120
            TabIndex        =   7
            Top             =   720
            Width           =   13215
            Begin VB.TextBox txtMemogarde_Envoi_Lien 
               Height          =   285
               Left            =   11400
               TabIndex        =   27
               Top             =   2280
               Width           =   1575
            End
            Begin VB.TextBox txtMemogarde_Envoi_Commentaire 
               Height          =   375
               Left            =   1560
               TabIndex        =   19
               Top             =   2160
               Width           =   7215
            End
            Begin VB.Frame fraMemogarde_Envoi_Windows 
               Caption         =   "Windows"
               BeginProperty Font 
                  Name            =   "MS Sans Serif"
                  Size            =   9.6
                  Charset         =   0
                  Weight          =   700
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H000000FF&
               Height          =   1815
               Left            =   11400
               TabIndex        =   15
               Top             =   240
               Width           =   1575
               Begin VB.OptionButton optMemogarde_Envoi_Windows_Totale 
                  Caption         =   "Complète"
                  Height          =   255
                  Left            =   240
                  TabIndex        =   18
                  Top             =   360
                  Value           =   -1  'True
                  Width           =   1215
               End
               Begin VB.OptionButton optMemogarde_Envoi_Windows_Partielle 
                  Caption         =   "Partielle"
                  Height          =   375
                  Left            =   240
                  TabIndex        =   17
                  Top             =   840
                  Width           =   1215
               End
               Begin VB.OptionButton optMemogarde_Envoi_Windows_Néant 
                  Caption         =   "Néant"
                  Height          =   255
                  Left            =   240
                  TabIndex        =   16
                  Top             =   1440
                  Width           =   855
               End
            End
            Begin VB.Frame fraMemogarde_Envoi_IBM 
               Caption         =   "IBM"
               BeginProperty Font 
                  Name            =   "MS Sans Serif"
                  Size            =   9.6
                  Charset         =   0
                  Weight          =   700
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H000000FF&
               Height          =   1815
               Left            =   9480
               TabIndex        =   11
               Top             =   240
               Width           =   1695
               Begin VB.OptionButton optMemogarde_Envoi_IBM_Néant 
                  Caption         =   "Néant"
                  Height          =   255
                  Left            =   240
                  TabIndex        =   14
                  Top             =   1440
                  Width           =   1095
               End
               Begin VB.OptionButton optMemogarde_Envoi_IBM_BIASAVF 
                  Caption         =   "BIASAVF"
                  Height          =   375
                  Left            =   240
                  TabIndex        =   13
                  Top             =   840
                  Width           =   1095
               End
               Begin VB.OptionButton optMemogarde_Envoi_IBM_Savnonsys 
                  Caption         =   "SAVNONSYS"
                  Height          =   255
                  Left            =   240
                  TabIndex        =   12
                  Top             =   360
                  Value           =   -1  'True
                  Width           =   1335
               End
            End
            Begin MSFlexGridLib.MSFlexGrid fgSelect 
               Height          =   1665
               Left            =   240
               TabIndex        =   8
               Top             =   360
               Width           =   8520
               _ExtentX        =   15028
               _ExtentY        =   2942
               _Version        =   393216
               Rows            =   1
               Cols            =   8
               FixedCols       =   0
               RowHeightMin    =   300
               BackColor       =   16777210
               ForeColor       =   8388608
               BackColorFixed  =   16776921
               ForeColorFixed  =   -2147483641
               BackColorSel    =   12648384
               BackColorBkg    =   16777210
               WordWrap        =   -1  'True
               AllowBigSelection=   0   'False
               TextStyleFixed  =   4
               FocusRect       =   2
               HighLight       =   0
               GridLines       =   3
               GridLinesFixed  =   1
               AllowUserResizing=   3
               FormatString    =   "<Conteneur  |>Lien        |<Date Compta   |<IBM        |<Windows |<Horodatage                    ||"
               BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
                  Name            =   "Courier New"
                  Size            =   8.4
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
            End
            Begin VB.Label lblMemogarde_Envoi_Lien 
               Caption         =   "N° lien"
               BeginProperty Font 
                  Name            =   "MS Sans Serif"
                  Size            =   9.6
                  Charset         =   0
                  Weight          =   700
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   255
               Left            =   10320
               TabIndex        =   26
               Top             =   2280
               Width           =   855
            End
            Begin VB.Label lblMemogarde_Envoi_Commentaire 
               Caption         =   "Commentaire"
               Height          =   255
               Left            =   360
               TabIndex        =   20
               Top             =   2280
               Width           =   1215
            End
         End
         Begin VB.ComboBox cboSelect_SQL 
            Height          =   315
            Left            =   120
            Sorted          =   -1  'True
            TabIndex        =   6
            Text            =   "cboSelect_SQL"
            Top             =   240
            Width           =   3615
         End
         Begin MSComCtl2.DTPicker txtSelect_AmjMin 
            Height          =   300
            Left            =   11280
            TabIndex        =   25
            Top             =   4680
            Width           =   1215
            _ExtentX        =   2138
            _ExtentY        =   529
            _Version        =   393216
            CalendarBackColor=   16777215
            CalendarForeColor=   0
            CalendarTitleBackColor=   8421504
            CalendarTitleForeColor=   16777215
            CalendarTrailingForeColor=   12632256
            CustomFormat    =   "dd  MM yyy"
            Format          =   101974019
            CurrentDate     =   38699.44875
            MaxDate         =   401768
            MinDate         =   36526.4425347222
         End
      End
   End
   Begin VB.CommandButton cmdPrint 
      BackColor       =   &H00E0E0E0&
      Height          =   500
      Left            =   13320
      Picture         =   "Bia_Exploitation.frx":0044
      Style           =   1  'Graphical
      TabIndex        =   1
      Top             =   0
      Width           =   500
   End
   Begin VB.CommandButton cmdContext 
      BackColor       =   &H00E0E0E0&
      Caption         =   "&Abandonner"
      Height          =   500
      Left            =   0
      Style           =   1  'Graphical
      TabIndex        =   0
      Top             =   0
      Width           =   1200
   End
   Begin VB.Label libRéférenceInterne 
      BackColor       =   &H00FFFFC0&
      BorderStyle     =   1  'Fixed Single
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   9.6
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   495
      Left            =   1200
      TabIndex        =   2
      Top             =   0
      Width           =   5535
      WordWrap        =   -1  'True
   End
   Begin VB.Menu mnuContext 
      Caption         =   "mnuContext"
      Visible         =   0   'False
      Begin VB.Menu mnuContextOptions 
         Caption         =   "Options"
      End
      Begin VB.Menu mnuContext_x1 
         Caption         =   "-"
      End
      Begin VB.Menu mnuContextAbandonner 
         Caption         =   "Abandonner"
      End
      Begin VB.Menu mnuContextQuitter 
         Caption         =   "Quitter"
      End
   End
   Begin VB.Menu mnuselect 
      Caption         =   "mnuSelect"
      Visible         =   0   'False
      Begin VB.Menu mnuSelect_Quit 
         Caption         =   "Abandonner"
      End
   End
   Begin VB.Menu mnuPrint0 
      Caption         =   "mnuPrint0"
      Visible         =   0   'False
      Begin VB.Menu mnuPrint0_All 
         Caption         =   "Imprimer TOUS les courriers"
      End
   End
End
Attribute VB_Name = "frmBia_Exploitation"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
'---------------------------------------------------------
Option Explicit
'---------------------------------------------------------
Dim mHeight_0 As Integer, mWidth_0 As Integer, mHeight_2 As Integer, mWidth_2 As Integer, mWindowState As Integer
Dim arrTag() As Boolean, arrTagNb As Integer
Dim lastActiveControl_Name  As String, currentActiveControl_Name As String, currentAction As String
Dim MouseMoveActiveControl_Name  As String, MouseMoveActiveControl As typeUsrColor
Dim blnMsgBox_Quit As Boolean, blnAddNew As Boolean, blnGlobalControl As Boolean, blnControl As Boolean
Dim X As String, I As Integer, Msg As String, valX As String, X1 As String, V As Variant, curX As Currency, dblX As Double
Dim intReturn As Integer
Dim BIA_Exploitation_Aut As typeAuthorization
Dim blnTransaction As Boolean
Dim blnAuto As Boolean, blnAuto_Ok As Boolean
Dim wAmjMin As String, wAmjMax As String, wHmsMin As Long, wHmsMax As Long
Dim wAmjMin7 As Long, wAmjMax7 As Long


Dim blncmdOk_Visible As Boolean, blnErr As Boolean, blncmdSave_Visible As Boolean
Dim blnSetfocus As Boolean

Dim fgSelect_FormatString As String, fgSelect_K As Integer
Dim fgSelect_RowDisplay As Integer, fgSelect_RowClick As Integer, fgSelect_ColClick As Integer
Dim fgSelect_ColorClick As Long, fgSelect_ColorDisplay As Long
Dim fgSelect_Sort1 As Integer, fgSelect_Sort2 As Integer
Dim fgSelect_SortAD As Integer, fgSelect_Sort1_Old As Integer
Dim fgSelect_arrIndex As Integer
Dim blnfgSelect_DisplayLine As Boolean

Dim cmdSelect_SQL_K As String
Dim cmdSelect_Ok_Caption As String
'______________________________________________________________________

Dim fgList_FormatString As String, fgList_K As Integer
Dim fgList_RowDisplay As Integer, fgList_RowClick As Integer, fgList_ColClick As Integer
Dim fgList_ColorClick As Long, fgList_ColorDisplay As Long
Dim fgList_Sort1 As Integer, fgList_Sort2 As Integer
Dim fgList_SortAD As Integer, fgList_Sort1_Old As Integer
Dim fgList_arrIndex As Integer
Dim blnfgList_DisplayLine As Boolean
'______________________________________________________________________

Dim xYBIAMON7   As typeYBIAMON0
Dim oldYBIAMON7_Envoi  As typeYBIAMON0, newYBIAMON7_Envoi  As typeYBIAMON0
Dim oldYBIAMON7_Retour  As typeYBIAMON0, newYBIAMON7_Retour  As typeYBIAMON0
Dim arrYBIAMON7()   As typeYBIAMON0, arrYBIAMON7_Max As Integer, arrYBIAMON7_Nb As Integer, arrYBIAMON7_Index As Integer
Dim oldYBIAMON7_Retour_Index As Integer, oldYBIAMON7_Envoi_Index As Integer
Dim newYBIAMON7_Retour_Index As Integer, newYBIAMON7_Envoi_Index As Integer

Dim blnMemogarde_OK As Boolean
Public Sub fgSelect_Color(lRow As Integer, lColor As Long, lColor_Old As Long)
Dim mRow As Integer, I As Integer
mRow = fgSelect.Row

If lRow > 0 And lRow < fgSelect.Rows Then
    fgSelect.Row = lRow
    For I = 0 To fgSelect_arrIndex
        fgSelect.Col = I: fgSelect.CellBackColor = lColor_Old
    Next I
End If
lRow = 0
If mRow > 0 Then
    fgSelect.Row = mRow
    If fgSelect.Row > 0 Then
        lRow = fgSelect.Row
        lColor_Old = fgSelect.CellBackColor
        For I = fgSelect_arrIndex To 0 Step -1
          fgSelect.Col = I: fgSelect.CellBackColor = lColor
        Next I
        fgSelect.LeftCol = 0
    End If
End If

End Sub
Public Sub fglist_Color(lRow As Integer, lColor As Long, lColor_Old As Long)
Dim mRow As Integer, I As Integer
mRow = fgList.Row

If lRow > 0 And lRow < fgList.Rows Then
    fgList.Row = lRow
    For I = 0 To fgList_arrIndex
        fgList.Col = I: fgList.CellBackColor = lColor_Old
    Next I
End If
lRow = 0
If mRow > 0 Then
    fgList.Row = mRow
    If fgList.Row > 0 Then
        lRow = fgList.Row
        lColor_Old = fgList.CellBackColor
        For I = fgList_arrIndex To 0 Step -1
          fgList.Col = I: fgList.CellBackColor = lColor
        Next I
        fgList.LeftCol = 0
    End If
End If

End Sub

Private Sub fgSelect_Display_1()
Dim I As Long, X As String
Dim blnOk As Boolean, blnDisplay As Boolean
Dim wIndex As Long

On Error GoTo Error_Handler
SSTab1.Tab = 0
fgSelect.Visible = False
fgSelect_Reset
fgSelect.Rows = 1
fgSelect.FormatString = fgSelect_FormatString
cmdPrint.Enabled = False
currentAction = "fgselect_Display"

For I = 1 To arrYBIAMON7_Nb

    If Trim(arrYBIAMON7(I).MONSTATUS) = "BIA" Then
        fgSelect.Rows = fgSelect.Rows + 1
        fgSelect.Row = fgSelect.Rows - 1
        If fgSelect.Row = 1 Then oldYBIAMON7_Envoi_Index = I: newYBIAMON7_Envoi_Index = I
        fgSelect_DisplayLine_1 I
    End If
    
Next I

Call lstErr_Clear(lstErr, cmdContext, "Nb enregistrements : " & fgSelect.Rows - 1): DoEvents
If fgSelect.Rows > 1 Then
'    fgSelect_Sort1 = 0: fgSelect_Sort2 = 2: fgSelect_Sort
    fgSelect.Row = 1
    Call fgSelect_Color(fgSelect_RowClick, vbGreen, fgSelect_ColorClick)

    cmdPrint.Enabled = True
End If
fgSelect.Visible = True
Exit Sub

Error_Handler:
    V = Error
Error_MsgBox:
    SSTab1.Tab = 0
    MsgBox V, vbCritical, Me.Name & " : " & currentAction



End Sub
Public Sub fgSelect_DisplayLine_1(lIndex As Long)
Dim X As String
On Error Resume Next
fgSelect.Col = 0: fgSelect.Text = arrYBIAMON7(lIndex).MONFLUX
'fgSelect.CellForeColor = IIf(fgSelect.Row = 1, vbRed, vbBlue)
    'fgSelect.Col = 1: fgSelect.Text = arrYBIAMON7(lIndex).MONNUM
    'fgSelect.CellForeColor = IIf(fgSelect.Row = 1, vbRed, vbBlue)
    'fgSelect.Col = 2: fgSelect.Text = dateImp10(arrYBIAMON7(lIndex).MONFILE)
    'fgSelect.CellForeColor = IIf(fgSelect.Row = 1, vbRed, vbBlue)
    'fgSelect.Col = 3: fgSelect.Text = arrYBIAMON7(lIndex).MONJOB
    'fgSelect.CellForeColor = IIf(fgSelect.Row = 1, vbRed, vbBlue)
    'fgSelect.Col = 4: fgSelect.Text = arrYBIAMON7(lIndex).MONPGM
    'fgSelect.CellForeColor = IIf(fgSelect.Row = 1, vbRed, vbBlue)
    'fgSelect.Col = 5: fgSelect.Text = dateImp10(arrYBIAMON7(lIndex).MONAMJ) & "  " & timeNImp8(arrYBIAMON7(lIndex).MONHMS)
fgSelect.Col = fgSelect_arrIndex: fgSelect.Text = lIndex

End Sub


Public Sub fglist_DisplayLine_1(lIndex As Long)
Dim X As String
On Error Resume Next
fgList.Col = 0: fgList.Text = arrYBIAMON7(lIndex).MONFLUX
'fgList.CellForeColor = IIf(fgList.Row = 1, vbRed, vbBlue)
fgList.Col = 1: fgList.Text = arrYBIAMON7(lIndex).MONNUM
'fgList.CellForeColor = IIf(fgList.Row = 1, vbRed, vbBlue)
fgList.Col = 2: fgList.Text = dateImp10(arrYBIAMON7(lIndex).MONFILE)
'fgList.CellForeColor = IIf(fgList.Row = 1, vbRed, vbBlue)
fgList.Col = 3: fgList.Text = arrYBIAMON7(lIndex).MONJOB
'fgList.CellForeColor = IIf(fgList.Row = 1, vbRed, vbBlue)
fgList.Col = 4: fgList.Text = arrYBIAMON7(lIndex).MONPGM
'fgList.CellForeColor = IIf(fgList.Row = 1, vbRed, vbBlue)
fgList.Col = 5: fgList.Text = dateImp10(arrYBIAMON7(lIndex).MONAMJ) & "  " & timeNImp8(arrYBIAMON7(lIndex).MONHMS)
fgList.Col = fgList_arrIndex: fgList.Text = lIndex

End Sub

Private Sub lstSelect_Load_1()
Dim I As Long, xSql As String
Dim blnOk As Boolean, blnDisplay As Boolean
Dim xWhere As String

On Error GoTo Error_Handler
SSTab1.Tab = 0
fgSelect.Visible = False
cmdPrint.Enabled = False
currentAction = "lstSelect_Load_1"
cmdSelect_Ok_Caption = "Lancer la requête"

cmdSelect_SQL_1

Exit Sub

Error_Handler:
    V = Error
Error_MsgBox:
    SSTab1.Tab = 0
    MsgBox V, vbCritical, Me.Name & " : " & currentAction



End Sub
Private Sub cmdSelect_SQL_1()
Dim V
Dim xSql As String, K As Long
Dim xWhere As String, xAnd As String
On Error GoTo Error_Handler

Set rsSab = Nothing
Call lstErr_Clear(lstErr, cmdContext, "cmdSelect_SQL"): DoEvents

currentAction = "cmdSelect_SQL"
oldYBIAMON7_Retour_Index = 0: oldYBIAMON7_Envoi_Index = 0
newYBIAMON7_Retour_Index = 0: newYBIAMON7_Envoi_Index = 0
Set rsSab = Nothing
ReDim arrYBIAMON7(11): arrYBIAMON7_Max = 10: arrYBIAMON7_Nb = 0

Set rsSab = Nothing

xSql = "select * from " & paramIBM_Library_SABSPE & ".YBIAMON7 where MONAPP = 'MEMOGARDE' order by MONFILE"
Set rsSab = cnsab.Execute(xSql)
cmdUpdate_Ok.Enabled = True
Do While Not rsSab.EOF
    V = rsYBIAMON0_GetBuffer(rsSab, xYBIAMON7)

     If Not IsNull(V) Then
         MsgBox V, vbCritical, "frmSwift_Messages.fgselect_Display"
        '' Exit Sub
     Else
         arrYBIAMON7_Nb = arrYBIAMON7_Nb + 1
         If arrYBIAMON7_Nb > arrYBIAMON7_Max Then
             arrYBIAMON7_Max = arrYBIAMON7_Max + 10
             ReDim Preserve arrYBIAMON7(arrYBIAMON7_Max)
         End If
         If Trim(xYBIAMON7.MONFILE) = YBIATAB0_DATE_CPT_J Then
            cmdUpdate_Ok.Enabled = False
            MsgBox " traitement du jour effectué ", vbInformation, "Memogarde " & dateImp10(YBIATAB0_DATE_CPT_J)

        End If
         arrYBIAMON7(arrYBIAMON7_Nb) = xYBIAMON7
    End If
    rsSab.MoveNext

Loop
    
fgSelect_Display_1
fglist_Display_1

Exit Sub

Error_Handler:
    V = Error
Error_MsgBox:
    SSTab1.Tab = 0
    MsgBox V, vbCritical, Me.Name & " : " & currentAction


End Sub

Public Sub cmdSendMail()
Dim wSendMail As typeSendMail
Dim bgColor As String
Dim xNb As String


xNb = "<BR><U> Memogarde : Gestion des conteneurs" & "</B></U></CENTER>"
    
wSendMail.FromDisplayName = "Memogarde"
wSendMail.RecipientDisplayName = "INFO"
If blnMemogarde_OK Then
    bgColor = "CYAN"
Else
    bgColor = "MAGENTA"
End If

wSendMail.Subject = "Sauvegarde : Gestion des conteneurs au " & dateImp(YBIATAB0_DATE_CPT_J)
wSendMail.Attachment = ""
wSendMail.Message = "<body bgcolor=" & Asc34 & bgColor & Asc34 & ">" _
                    & "<FONT face=Arial>" _
                    & htmlFontColor("BLUE") & "<B><CENTER>" & xNb _
                    & "<BR>Envoi du conteneur : <B>" & newYBIAMON7_Envoi.MONFLUX & " sauvegarde du " & dateImp(Trim(newYBIAMON7_Envoi.MONFILE)) & htmlFontColor("RED") & " N° lien : " & newYBIAMON7_Envoi.MONNUM & "</B>" _
                    & htmlFontColor("BLUE") & "<BR><HR><PRE> - IBM     : " & newYBIAMON7_Envoi.MONJOB _
                    & "<BR> - Windows : " & newYBIAMON7_Envoi.MONPGM & "</PRE>" _
                    & "<BR>" & htmlFontColor("RED") & Trim(txtMemogarde_Envoi_Commentaire) & htmlFontColor("BLUE") _
                    & "<BR>Retour du conteneur <B>" & newYBIAMON7_Retour.MONFLUX & " sauvegarde du " & dateImp(Trim(newYBIAMON7_Retour.MONFILE)) & "</B>" _
                    & "<BR><HR>" & htmlFontColor("RED") & Trim(txtMemogarde_Retour_Commentaire) & htmlFontColor("BLUE")
wSendMail.AsHTML = True

srvSendMail.Monitor wSendMail

End Sub


Public Sub fgSelect_Reset()
fgSelect.Clear
fgSelect_Sort1 = 0: fgSelect_Sort2 = 0
fgSelect_Sort1_Old = -1
fgSelect_RowDisplay = 0: fgSelect_RowClick = 0
fgSelect_arrIndex = fgSelect.Cols - 1
blnfgSelect_DisplayLine = False
fgSelect_SortAD = 6
fgSelect.LeftCol = 0

End Sub



Public Sub fgSelect_Sort()
If fgSelect.Rows > 1 Then
    fgSelect.Row = 1
    fgSelect.RowSel = fgSelect.Rows - 1
    
    If fgSelect_Sort1_Old = fgSelect_Sort1 Then
        If fgSelect_SortAD = 5 Then
            fgSelect_SortAD = 6
        Else
            fgSelect_SortAD = 5
        End If
    Else
        fgSelect_SortAD = 5
    End If
    fgSelect_Sort1_Old = fgSelect_Sort1
    
    fgSelect.Col = fgSelect_Sort1
    fgSelect.ColSel = fgSelect_Sort2
    fgSelect.Sort = fgSelect_SortAD
End If

End Sub
Public Sub fglist_Sort()
If fgList.Rows > 1 Then
    fgList.Row = 1
    fgList.RowSel = fgList.Rows - 1
    
    If fgList_Sort1_Old = fgList_Sort1 Then
        If fgList_SortAD = 5 Then
            fgList_SortAD = 6
        Else
            fgList_SortAD = 5
        End If
    Else
        fgList_SortAD = 5
    End If
    fgList_Sort1_Old = fgList_Sort1
    
    fgList.Col = fgList_Sort1
    fgList.ColSel = fgList_Sort2
    fgList.Sort = fgList_SortAD
End If

End Sub

Public Sub fgSelect_SortX(lK As Integer)
Dim I As Integer, X As String
Dim wIndex As Integer
For I = 1 To fgSelect.Rows - 1
    fgSelect.Row = I
    fgSelect.Col = fgSelect_arrIndex
    wIndex = Val(fgSelect.Text)
    Select Case lK
    End Select
    fgSelect.Col = fgSelect_arrIndex - 1
    fgSelect.Text = X
Next I


fgSelect_Sort1 = fgSelect_arrIndex - 1: fgSelect_Sort2 = fgSelect_arrIndex - 1
fgSelect_Sort
End Sub
Private Sub fglist_Display_1()
Dim I As Long, X As String
Dim blnOk As Boolean, blnDisplay As Boolean

On Error GoTo Error_Handler
SSTab1.Tab = 0
fgList.Visible = False
fglist_Reset
fgList.Rows = 1
fgList.FormatString = fgList_FormatString
cmdPrint.Enabled = False
currentAction = "fgList_Display_1"

For I = 1 To arrYBIAMON7_Nb

    If Trim(arrYBIAMON7(I).MONSTATUS) <> "BIA" Then
        fgList.Rows = fgList.Rows + 1
        fgList.Row = fgList.Rows - 1
        If fgList.Row = 1 Then oldYBIAMON7_Retour_Index = I: newYBIAMON7_Retour_Index = I
        fglist_DisplayLine_1 I
    End If
    
Next I

If fgList.Rows > 1 Then

    fgList.Row = 1
    Call fglist_Color(fgList_RowClick, vbGreen, fgList_ColorClick)
End If
fgList.Visible = True
Exit Sub

Error_Handler:
    V = Error
Error_MsgBox:
    SSTab1.Tab = 0
    MsgBox V, vbCritical, Me.Name & " : " & currentAction

fgList.Visible = True


End Sub

Public Sub fglist_Reset()
fgList.Clear
fgList_Sort1 = 0: fgList_Sort2 = 0
fgList_Sort1_Old = -1
fgList_RowDisplay = 0: fgList_RowClick = 0
fgList_arrIndex = fgList.Cols - 1
blnfgList_DisplayLine = False
fgList_SortAD = 6
fgList.LeftCol = 0

End Sub


'---------------------------------------------------------
Public Sub arrTag_Set(ByVal B As Boolean)
'---------------------------------------------------------
For I = 0 To arrTagNb: arrTag(I) = B: Next I
End Sub


Public Sub cmdContext_Quit()
Unload Me
End Sub




Private Sub cboSelect_SQL_Click()
cmdSelect_SQL_K = mId$(cboSelect_SQL, 1, 1)
If blnControl Then
    Me.Enabled = False: Me.MousePointer = vbHourglass
    Select Case cmdSelect_SQL_K
        Case "1": lstSelect_Load_1
    End Select
    Me.Enabled = True: Me.MousePointer = 0
End If
End Sub


Private Sub cmdContext_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)
MouseMoveActiveControl_Set cmdContext

End Sub

Private Sub cmdPrint_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)
MouseMoveActiveControl_Set cmdPrint

End Sub

'---------------------------------------------------------
Public Sub cmdReset()
'---------------------------------------------------------
Dim I As Integer

blnControl = False
usrColor_Set

cmdContext.Caption = constcmdRechercher: blnMsgBox_Quit = False
arrTag_Set False
lstErr.Visible = False
blncmdOk_Visible = False: blncmdSave_Visible = False
currentAction = ""
fraMemogarde_Envoi.ForeColor = vbRed
fraMemogarde_Envoi_IBM.ForeColor = vbRed
fraMemogarde_Envoi_Windows.ForeColor = vbRed
fraMemogarde_Retour.ForeColor = vbGreen
txtSelect_AmjMin.Visible = True
txtSelect_AmjMin.Enabled = False
Call DTPicker_Set(txtSelect_AmjMin, YBIATAB0_DATE_CPT_J)

blnAuto = False
blnAuto_Ok = False

libRéférenceInterne = ""
blnControl = True
cboSelect_SQL.ListIndex = 0
End Sub
Public Sub Form_Init()
Call lstErr_Clear(lstErr, cmdContext, "Initialisation ")
DoEvents

SSTab1.Tab = 0

blnControl = False

fgSelect.Visible = False
fgSelect_FormatString = fgSelect.FormatString
fgList_FormatString = fgList.FormatString
cboSelect_SQL.Clear
cboSelect_SQL.AddItem "1 - Memogarde"

cmdReset



End Sub

Public Sub MouseMoveActiveControl_Reset()
For Each xobj In Me.Controls
    If MouseMoveActiveControl_Name = xobj.Name Then
        MouseMoveActiveControl_Name = ""
         If TypeOf xobj Is CommandButton Or TypeOf xobj Is ListBox Then
           xobj.BackColor = MouseMoveActiveControl.BackColor
        Else
            xobj.ForeColor = MouseMoveActiveControl.ForeColor
        End If
        Exit For
    End If
Next xobj

End Sub

Public Sub MouseMoveActiveControl_Set(C As Control)
If MouseMoveActiveControl_Name <> C.Name Then
    MouseMoveActiveControl_Reset
    If Not C.Enabled Then
        MouseMoveActiveControl_Name = ""
    Else
        MouseMoveActiveControl_Name = C.Name
        If TypeOf C Is CommandButton Or TypeOf C Is ListBox Then
            
            MouseMoveActiveControl.BackColor = C.BackColor
            C.BackColor = MouseMoveUsr.BackColor
        Else
            MouseMoveActiveControl.ForeColor = C.ForeColor
            C.ForeColor = MouseMoveUsr.ForeColor
        End If
    End If
End If

End Sub

'-------------------------------------------------------
Sub txt_GotFocus(C As Control)
'-------------------------------------------------------
currentActiveControl_Name = C.Name
C.ForeColor = txtUsr.ForeColor
C.BackColor = focusUsr.BackColor
End Sub


'-------------------------------------------------------
Sub txt_LostFocus(C As Control)
'-------------------------------------------------------
arrTag(Val(C.Tag)) = True
C.ForeColor = txtUsr.ForeColor
C.BackColor = txtUsr.BackColor
End Sub


Private Sub cmdContext_MouseDown(Button As Integer, Shift As Integer, X As Single, Y As Single)
Select Case cmdContext.Caption
    Case Is = constcmdRechercher: Me.PopupMenu mnuContext, vbPopupMenuLeftButton
    Case Is = constcmdAbandonner: cmdContext_Quit
End Select

End Sub

Private Sub cmdPrint_Click()
Dim Msg As String
Dim I As Integer

Me.Enabled = False: Me.MousePointer = vbHourglass
    Select Case cmdSelect_SQL_K
    '    Case "2": cmdPrint_Ok_2
    '    Case "3": cmdPrint_Ok_3
    End Select

Me.Show

Me.Enabled = True: Me.MousePointer = 0

End Sub

Private Sub cmdUpdate_Ok_Click()
Dim V
Me.Enabled = False: Me.MousePointer = vbHourglass
Call lstErr_Clear(lstErr, cmdContext, "> Début du traitement"): DoEvents

If IsNull(cmdUpdate_Control) Then
    Call lstErr_AddItem(lstErr, cmdContext, ">_________Enregistrement des données "): DoEvents
    V = cmdUpdate_Ok_Transaction
    cmdSendMail
    '$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
    If IsNull(V) Then
        cmdUpdate_Ok.Enabled = False
        Unload Me
    Else
        MsgBox V, vbCritical, Me.Name & " : cmdUpdate_Ok"
        Call lstErr_AddItem(lstErr, cmdContext, V): DoEvents
    
    End If
End If
Call lstErr_AddItem(lstErr, cmdContext, "< Fin du Traitement"): DoEvents

Me.Enabled = True: Me.MousePointer = 0

End Sub

Private Sub cmdUpdate_Quit_Click()
Unload Me
End Sub

Private Sub fgList_MouseDown(Button As Integer, Shift As Integer, X As Single, Y As Single)
Dim K As Long
Dim X1 As String, X2 As String
Me.Enabled = False
On Error Resume Next
If Y <= fgList.RowHeightMin Then
        Select Case fgList.Col
            Case 0: fgList_Sort1 = 0: fgList_Sort2 = 0: fglist_Sort
            Case 1:  fgList_Sort1 = 1: fgList_Sort2 = 1: fglist_Sort
            Case 2: fgList_Sort1 = 2: fgList_Sort2 = 2: fglist_Sort
        End Select
Else
    If fgList.Rows > 1 Then
        Me.Enabled = False: Me.MousePointer = vbHourglass
        fgList.Col = fgSelect_arrIndex:  arrYBIAMON7_Index = CLng(fgList.Text)
'        Call fglist_Color(fgList_RowClick, MouseMoveUsr.BackColor, fgList_ColorClick)
        Call fglist_Color(fgList_RowClick, vbGreen, fgList_ColorClick)
        newYBIAMON7_Retour_Index = arrYBIAMON7_Index
        Me.Enabled = True: Me.MousePointer = 0
   End If
End If
Me.Enabled = True

End Sub


Private Sub fgSelect_MouseDown(Button As Integer, Shift As Integer, X As Single, Y As Single)
Dim K As Long
Me.Enabled = False
On Error Resume Next
If Y <= fgSelect.RowHeightMin Then
        Select Case fgSelect.Col
            Case 0: fgSelect_Sort1 = 0: fgSelect_Sort2 = 0: fgSelect_Sort
            Case 1:  fgSelect_Sort1 = 1: fgSelect_Sort2 = 1: fgSelect_Sort
            Case 2: fgSelect_Sort1 = 2: fgSelect_Sort2 = 2: fgSelect_Sort
           Case fgSelect_arrIndex:  fgSelect_SortX fgSelect_arrIndex
        End Select
Else
    If fgSelect.Rows > 1 Then
        Me.Enabled = False: Me.MousePointer = vbHourglass
        fgSelect.Col = fgSelect_arrIndex:  arrYBIAMON7_Index = CLng(fgSelect.Text)
        Call fgSelect_Color(fgSelect_RowClick, vbGreen, fgSelect_ColorClick)
        newYBIAMON7_Envoi_Index = arrYBIAMON7_Index
        Me.Enabled = True: Me.MousePointer = 0

   End If
End If
Me.Enabled = True
End Sub


'---------------------------------------------------------
Private Sub Form_Activate()
'---------------------------------------------------------
Set XForm = Me
End Sub

'---------------------------------------------------------
Private Sub Form_KeyUp(KeyCode As Integer, Shift As Integer)
'---------------------------------------------------------
Select Case KeyCode
    Case Is = 13: KeyCode = 0: cmdContext_Return
    Case Is = 27: cmdContext_Quit
'   Case Is = 34: cmdPageNext_Click
'   Case Is = 33: cmdPagePrior_Click
    Case Is = 44: KeyCode = 0: frmElpPrt.prtScreen
End Select

End Sub

'---------------------------------------------------------
Private Sub Form_Load()
'---------------------------------------------------------
mHeight_0 = Me.Height: mWidth_0 = Me.Width: mHeight_2 = 0: mWidth_2 = 0: mWindowState = Me.WindowState
Set XForm = Me
Call MeInit(arrTagNb)
ReDim arrTag(arrTagNb + 1)
blnControl = False
End Sub

Private Sub Form_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)
MouseMoveActiveControl_Reset
End Sub


Private Sub Form_Resize()
If mWindowState <> Me.WindowState Then
    If Me.WindowState = 0 Or Me.WindowState = 2 Then
        Elp_Form_Resize Me, mWindowState, mHeight_0, mWidth_0, mHeight_2, mWidth_2
    End If
End If

End Sub

Private Sub mnuContextAbandonner_Click()
cmdContext_Quit
End Sub

Private Sub mnuContextQuitter_Click()
Unload Me
End Sub

Public Sub Msg_Rcv(Msg As String)
'---------------------------------------------------------
Dim meUnit As typeUnit, X As String
mWindowState = Me.WindowState
If Me.WindowState <> frmUsr_Windowstate Then Me.WindowState = frmUsr_Windowstate

Call BiaPgmAut_Init(mId$(Msg, 1, 12), BIA_Exploitation_Aut)

blnSetfocus = True
Form_Init
blnAuto = False

Select Case UCase$(Trim(mId$(Msg, 1, 12)))

    Case Else: blnAuto = False
                
                    
End Select


End Sub


Public Sub cmdContext_Return()
If SSTab1.Tab = 0 Then
'    If fraUpdate.Visible _
'   And fraUpdate_B.Enabled _
'    And cmdUpdate_Ok.Enabled Then cmdUpdate_Ok_Click: Exit Sub
Else
    If currentAction = "" Then
        If SSTab1.Tab > 0 Then
            SSTab1.Tab = 0
        Else
           'SendKeys "{TAB}"
           ' cmdSelect_Click
        End If
    End If
End If
End Sub









Private Sub mnuPrint0_All_Click()
Dim I As Long, K As Long
Me.Enabled = False: Me.MousePointer = vbHourglass
    

Me.Show

Me.Enabled = True: Me.MousePointer = 0



End Sub





Public Function cmdUpdate_Control()
Dim wLien As Long

cmdUpdate_Control = Null
blnMemogarde_OK = True
wLien = Val(Trim(txtMemogarde_Envoi_Lien))
If wLien = 0 Then
    X = MsgBox(" Précisez le N° du lien ", vbCritical, "frmBia_Exploitation")
        cmdUpdate_Control = "Exit"
        Exit Function
End If

If oldYBIAMON7_Retour_Index <> newYBIAMON7_Retour_Index Then
    X = MsgBox("Confirmez-vous le retour du conteneur " & arrYBIAMON7(newYBIAMON7_Retour_Index).MONFLUX & "?", vbYesNo + vbQuestion + vbDefaultButton2, "Ce conteneur n'est pas le plus ancien")
    If X <> vbYes Then
        cmdUpdate_Control = "Exit"
        Exit Function
    End If
End If
If oldYBIAMON7_Envoi_Index <> newYBIAMON7_Envoi_Index Then
    X = MsgBox("Confirmez-vous le envoi du conteneur " & arrYBIAMON7(newYBIAMON7_Envoi_Index).MONFLUX & "?", vbYesNo + vbQuestion + vbDefaultButton2, "Ce conteneur n'est pas le plus ancien")
    If X <> vbYes Then
        cmdUpdate_Control = "Exit"
        Exit Function
    End If
End If

If Not optMemogarde_Envoi_IBM_Savnonsys Then
    If Trim(txtMemogarde_Envoi_Commentaire) = "" Then
    X = MsgBox(" Précisez le motif ", vbCritical, "IBM sauvegarde partielle")
        cmdUpdate_Control = "Exit"
        Exit Function
    End If
End If

If Not optMemogarde_Envoi_Windows_Totale Then
    If Trim(txtMemogarde_Envoi_Commentaire) = "" Then
    X = MsgBox(" Précisez le motif ", vbCritical, "Windows sauvegarde partielle")
        cmdUpdate_Control = "Exit"
        Exit Function
    End If
End If
oldYBIAMON7_Retour = arrYBIAMON7(newYBIAMON7_Retour_Index)
newYBIAMON7_Retour = oldYBIAMON7_Retour
newYBIAMON7_Retour.MONSTATUS = "BIA"

oldYBIAMON7_Envoi = arrYBIAMON7(newYBIAMON7_Envoi_Index)
newYBIAMON7_Envoi = oldYBIAMON7_Envoi
newYBIAMON7_Envoi.MONSTATUS = "MEMOGARDE"
newYBIAMON7_Envoi.MONFILE = YBIATAB0_DATE_CPT_J
newYBIAMON7_Envoi.MONNUM = wLien
If optMemogarde_Envoi_IBM_Savnonsys Then newYBIAMON7_Envoi.MONJOB = "SAVNONSYS"
If optMemogarde_Envoi_IBM_BIASAVF Then newYBIAMON7_Envoi.MONJOB = "BIASAVF": blnMemogarde_OK = False
If optMemogarde_Envoi_IBM_Néant Then newYBIAMON7_Envoi.MONJOB = "Néant": blnMemogarde_OK = False
If optMemogarde_Envoi_Windows_Totale Then newYBIAMON7_Envoi.MONPGM = "Totale"
If optMemogarde_Envoi_Windows_Partielle Then newYBIAMON7_Envoi.MONPGM = "Partielle": blnMemogarde_OK = False
If optMemogarde_Envoi_Windows_Néant Then newYBIAMON7_Envoi.MONPGM = "Néant": blnMemogarde_OK = False
End Function

Public Function cmdUpdate_Ok_Transaction()
Dim V, X As String, xSql As String
Dim Nb As Long
Dim mMsgBox As String
On Error GoTo Error_Handler
'-------------------------------------------------------
App_Debug = "cmdUpdate_Ok_Transaction"
'-------------------------------------------------------
cmdUpdate_Ok_Transaction = Null
'$ TRANSACTION >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
V = cnSAB_Transaction("BeginTrans")
If Not IsNull(V) Then GoTo Error_MsgBox
'________________________________________________________________________________
V = sqlYBIAMON0_Update(newYBIAMON7_Envoi, oldYBIAMON7_Envoi, True)
If Not IsNull(V) Then GoTo Error_MsgBox
V = sqlYBIAMON0_Update(newYBIAMON7_Retour, oldYBIAMON7_Retour, True)
If Not IsNull(V) Then GoTo Error_MsgBox
GoTo Exit_Sub

'------------------------------------------
Error_Handler:
    V = Error
Error_MsgBox:
    MsgBox V, vbCritical, frmElp_Caption & App_Debug
Exit_Sub:
    If Not IsNull(V) Then
        V = cnSAB_Transaction("Rollback")
    Else
        V = cnSAB_Transaction("Commit")
    End If
    
    cmdUpdate_Ok_Transaction = V
'$ TRANSACTION <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<

End Function

Private Sub txtMemogarde_Envoi_Lien_KeyPress(KeyAscii As Integer)
KeyAscii = ctlNum(KeyAscii)
End Sub


